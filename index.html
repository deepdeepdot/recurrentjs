<html>
  <head>
    <title>RecurrentJS Sentence Memorization Demo</title>
    <link rel="stylesheet" href="dist/style.css"/>
  </head>

  <body>
    <a href="https://github.com/lucidrains/recurrentjs">
      <img id="forkme" src="src/images/forkme.png" alt="Fork me on GitHub">
    </a>

    <div id="wrap">
      <h1>Deep Recurrent Nets character generation demo</h1>
      <div id="intro">
        This demo shows usage of the <a href="https://github.com/lucidrains/recurrentjs">recurrentjs library</a> that allows you to train deep Recurrent Neural Networks (RNN) and Long Short-Term Memory Networks (LSTM) in Javascript. But the core of the library is more general and allows you to set up arbitrary expression graphs that support fully automatic backpropagation.<br><br>

        In this demo we take a dataset of sentences as input and learn to memorize the sentences character by character. That is, the RNN/LSTM takes a character, its context from previous time steps (as mediated by the hidden layers) and predicts the next character in the sequence. Here is an example: <br><br>

        <div style="text-align:center;"><img src="src/images/eg.png"></div>

        In the example image above that depicts a deep RNN, every character has an associated "letter vector" that we will train with backpropagation. These letter vectors are combined through a (learnable) Matrix-vector multiply transformation into the first hidden layer representation (yellow), then into second hidden layer representation (purple), and finally into the output space (blue). The output space has dimensionality equal to the number of characters in the dataset and every dimension provides the probability of the next character in the sequence. The network is therefore trained to always predict the next character (using Softmax + cross-entropy loss on all letters). The quantity we track during training is called the <b>perplexity</b>, which measures how surprised the network is to see the next character in a sequence. For example, if perplexity is 4.0 then it's as if the network was guessing uniformly at random from 4 possible characters for next letter (i.e. lowest it can be is 1). At test time, the prediction is currently done iteratively character by character in a greedy fashion, but I might eventually implemented more sophisticated methods (e.g. beam search).<br><br>

        The demo is pre-filled with sentences from <a href="http://www.paulgraham.com/articles.html">Paul Graham's essays</a>, in an attempt to encode Paul Graham's knowledge into the weights of the Recurrent Networks. The long-term goal of the project then is to generate startup wisdom at will. Feel free to train on whatever data you wish, and to experiment with the parameters. If you want more impressive models you have to increase the sizes of hidden layers, and maybe slightly the letter vectors. However, this will take longer to train.<br><br>

        For suggestions/bugs ping me at <a href="https://twitter.com/karpathy">@karpathy</a>.<br><br>
      </div>
      
      <div id="application">
        <div>
          <div class="hh">Input files:</div>
          <div id="choose_input_file"></div>
          <div class="hh">Input sentences:</div>
          <div id="prepro_status"></div>
          <textarea id="input_text"></textarea>
        </div>

        <div class="hh">Controls/Options:</div>
        
        <button id="learn" class="abutton">learn/restart</button>
        <button id="resume" class="abutton">resume</button>
        <button id="stop" class="abutton">pause</button>
        <!-- <button id="gradcheck">gradcheck</button> -->
        
        <textarea id="newnet" style="width:100%; height:200px;">
  // model parameters
  generator = 'lstm'; // can be 'rnn' or 'lstm'
  hidden_sizes = [20,20]; // list of sizes of hidden layers
  letter_size = 5; // size of letter embeddings

  // optimization
  regc = 0.000001; // L2 regularization strength
  learning_rate = 0.01; // learning rate
  clipval = 5.0; // clip gradients at this value
        </textarea>

        <p>
          protip: if your perplexity is exploding with Infinity try lowering the initial learning rate
        </p>
        
        <div id="status">
          <div>
            <div class="hh">Training stats:</div>
            <div class="aslider" id="learning_slider">
            </div>

            <div id="pplgraph"></div>
            <div id="ticktime"></div>
            <div id="gradclip"></div>
            <div id="epoch"></div>
            <div id="ppl"></div>

            <div style="clear:both;"></div>
          </div>

          <div class="hh">Model samples:</div>
          <div id="controls">
            <div class="aslider" id="temperature_slider"></div>
          </div>
          <div id="samples"></div>
          <div class="hh">Greedy argmax prediction:</div>
          <div id="argmax"></div>
        </div>

        <div id="io">
          <div class="hh">I/O save/load model JSON</div>

          <button id="savemodel" class="abutton">save model</button>
          <button id="loadmodel" class="abutton">load model</button>
          <div>
            You can save or load models with JSON using the textarea below.
          </div>
          <textarea style="width:100%; height:200px;" id="tio"></textarea>

          <div class="hh">Pretrained model:</div>
          <p>
            You can also choose to load an example pretrained model with the button below to see what the predictions look like in later stages. The pretrained model is an LSTM with one layer of 100 units, trained for ~10 hours. After clicking button below you should see the perplexity plummet to about 3.0, and see the predictions become better.
          </p>
          <button id="loadpretrained" class="abutton">load pretrained</button>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      window.input_files = ["nietzsche.txt","paulgraham.txt","shakespeare.txt"];
    </script>

    <script type="text/javascript" src="dist/app.js"></script>
  </body>
</html>